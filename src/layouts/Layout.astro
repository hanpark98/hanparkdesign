---
import '../styles/global.css';
import Analytics from '@vercel/analytics/astro';
const { title } = Astro.props;
const showNav = Astro.url.pathname !== '/';
const showFooter = Astro.url.pathname !== '/';
---

<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <title>{title ?? 'í•œê²°'}</title>

    <style is:global>
      main { flex: 1 1 auto; min-height: 0; }
    </style>

    <style>
      :root{
        --nav-radius: 16px; /* postcardì™€ ë™ì¼ */
        --nav-pad-x: 27px;  /* ë‚´ë¶€ ì¢Œìš° íŒ¨ë”© */
        --nav-pad-t: 22px;  /* ë‚´ë¶€ ìƒë‹¨ íŒ¨ë”© */
        --nav-pad-b: 22px;  /* ë‚´ë¶€ í•˜ë‹¨ íŒ¨ë”©(í•„ìš” ì‹œ 0ìœ¼ë¡œ) */
        --nav-side-gap: 24px; /* ì–‘ì˜† ë§ˆì§„(ìƒì ì™¸ë¶€ ì—¬ë°±) */
        --nav-gradient: linear-gradient(
          to bottom,
          #040404 0%,
          #040404 18%,
          #13151e 34%,
          #2f3756 50%,
          #747e89 80%,
          #c3c0ba 100%
        );
      }
      .layout-root {
        background: #ebe9e5;
        min-height: 100vh;
      }

      /* ë°°ê²½ ë ˆì¼(í˜ì´ì§€ í†¤ ìœ ì§€ + sticky) */
      .site-nav{
        position: sticky; top: 0; z-index: 50;
        background: transparent; /* í˜ì´ì§€ ë°°ê²½ */
        padding-top: 0; padding-left: 0; padding-right: 0; padding-bottom: 0;
      }

      /* ì‹¤ì œ ë„¤ë¹„ ìƒì */
      .site-nav-box{
        display:flex;
        justify-content:space-between;
        align-items:flex-start;
        margin: 0 max(var(--nav-side-gap), env(safe-area-inset-left)) 0 max(var(--nav-side-gap), env(safe-area-inset-right));
        background: var(--nav-gradient);
        border-radius: 0 0 var(--nav-radius) var(--nav-radius); /* ì•„ë˜ë§Œ ë¼ìš´ë“œ */
        padding: var(--nav-pad-t) var(--nav-pad-x) var(--nav-pad-b);
        box-sizing: border-box;

        -webkit-transform: translateZ(0);

        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.18);
        transition: box-shadow 0.25s ease, transform 0.25s ease;
      }

      .site-nav-box:hover {
        box-shadow: 6px 6px 10px rgba(0, 0, 0, 0.18);
        transform: translateY(-2px);
      }

      /* ì¢Œì¸¡ ë¸Œëœë“œ */
      .site-brand{
        display:flex; align-items:center; gap: 12px; min-width:0;
        text-decoration:none; color:#fff;
      }
      .brand-logo{
        height: clamp(28px, 3.7vw, 30px); width:auto; object-fit:contain; border-radius:0;
        filter: invert(1) brightness(1.05) contrast(1.05);
      }
      .brand-title{
        font-weight:500; font-size: clamp(22px, 3.5vw, 25px);
        letter-spacing:0.01em; line-height:1; white-space:nowrap; color:#fff;
        overflow:hidden; text-overflow:ellipsis;
      }

      /* ê²€ìƒ‰ì°½: ë‹¤í¬ ë°°ê²½ ëŒ€ë¹„ */
      #search-form{
        position: relative; display:flex; align-items:center; flex:0 0 auto;
        width: min(11rem, 46vw); margin-top: 0;
      }
      #search-input{
        width:100%;
        font-size: clamp(14px, 3.6vw, 15px); line-height:1.1;
        padding: 0.5rem 2.0rem 0.5rem 0.9rem;
        border-radius: 9999px; border: 0;
        background: rgba(255,255,255,0.92); color:#111;
        outline: none; transition: box-shadow .2s, background .2s;
      }
      #search-input::placeholder{ color: rgba(0,0,0,.5); }
      #search-form button{
        position:absolute; right: .6rem; top:50%; transform: translateY(-50%);
        background:none; border:none; color:#111; cursor:pointer;
      }
      #search-form svg{ width:1rem; height:1rem; }

      #search-input:focus{ box-shadow: 0 0 0 0px rgba(255,255,255,.6), 0 0 0 5px rgba(0,0,0,.2) inset; }

/* ë³€ê²½ í›„ (ëª¨ë°”ì¼ì—ì„œ ì—¬ë°±ì„ 12pxë¡œ ì¶•ì†Œ) */
@media (max-width: 640px){
  .site-nav-box{ margin-inline: max(12px, env(safe-area-inset-left)); }
  #search-form{ width: min(10rem, 52vw); }
}
@media (max-width: 400px){
  /* 400px ì´í•˜ì—ì„œë„ ë™ì¼í•˜ê²Œ 12px ìœ ì§€ */
  .site-nav-box{ margin-inline: max(12px, env(safe-area-inset-left)); }
  #search-form{ width: min(9.2rem, 56vw); }
}
    </style>
  </head>

  <body>
    <div class="layout-root">
      {showNav && (
        <nav class="site-nav">
          <div class="site-nav-box">
            <a href="/" class="site-brand" aria-label="í™ˆ">
              <img src="/images/website/logo.svg" alt="ë¡œê³ " class="brand-logo" />
              <span class="brand-title">Han Park</span>
            </a>

            <form id="search-form">
              <input type="search" placeholder="Search" id="search-input" />
              <button type="submit" aria-label="ê²€ìƒ‰">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <circle cx="11" cy="11" r="7" stroke-width="2" />
                  <line x1="16.5" y1="16.5" x2="21" y2="21" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </button>
            </form>
          </div>
        </nav>
      )}

      <main>
        <slot />
      </main>

      {showFooter && (
        <footer style="
          background: #F8F8FF;
          border-top: 1px solid #eee;
          text-align: center;
          color: #999;
          font-size: 0.8rem;
          padding: 0.6rem 0 0.6rem 0;
          margin-top: 0;
          flex-shrink: 0;
        ">
          Â© {new Date().getFullYear()} Han Park | All rights reserved. | hanparkdesign@gmail.com
        </footer>
      )}
    </div>

    <Analytics/>

    <script>
      // ë¹„ë””ì˜¤ êµ¬ì¡°/ì˜¤ë²„ë ˆì´ ì„¸íŒ…
function enhanceVideo(video) {
  const isCarousel = video.classList.contains('my-carousel-img');

  if (isCarousel) {
    // ìºëŸ¬ì…€ ë¹„ë””ì˜¤ëŠ” ë˜í¼ ì‚¬ìš© ì•ˆ í•¨. í˜¹ì‹œ ì˜ˆì „ ë˜í¼ ìˆìœ¼ë©´ í’€ì–´ì¤€ë‹¤.
    const existingWrapper = video.closest('.video-wrapper');
    if (existingWrapper) {
      const parent = existingWrapper.parentNode;
      if (parent) {
        parent.insertBefore(video, existingWrapper);
      }
      existingWrapper.remove();
    }

    // ìºëŸ¬ì…€ ë¹„ë””ì˜¤ ì˜¤ë²„ë ˆì´ ìƒì„±
    const item = video.closest('.my-carousel-item');
    if (item && !item.querySelector('.carousel-video-overlay')) {
      const overlay = document.createElement('div');
      overlay.className = 'carousel-video-overlay';
      item.appendChild(overlay);
    }
    return null;
  }

  // ê·¸ ì™¸(ì¼ë°˜) ë¹„ë””ì˜¤ëŠ” ë˜í¼ + video-play-overlay ì‚¬ìš©
  let wrapper = video.closest('.video-wrapper');
  if (wrapper) {
    return wrapper;
  }

  wrapper = document.createElement('div');
  wrapper.className = 'video-wrapper';

  const parent = video.parentNode;
  if (!parent) return null;

  parent.insertBefore(wrapper, video);
  wrapper.appendChild(video);

  const overlay = document.createElement('div');
  overlay.className = 'video-play-overlay';
  wrapper.appendChild(overlay);

  // ğŸ”¹ ì¬ìƒ/ì •ì§€ ìƒíƒœì— ë”°ë¼ ì•„ì´ì½˜ ë°”ê¿”ì£¼ê¸°
  let hasPlayed = false;

  const syncOverlay = () => {
    if (video.paused) {
      // ì•„ì§ í•œ ë²ˆë„ ì¬ìƒ ì•ˆ í–ˆìœ¼ë©´ â†’ ê¸°ë³¸ ì‚¼ê°í˜• ìœ ì§€
      if (hasPlayed) {
        wrapper.classList.add('is-paused');
      }
      wrapper.classList.remove('is-playing');
    } else {
      // ì¬ìƒ ì¤‘
      hasPlayed = true;
      wrapper.classList.add('is-playing');
      wrapper.classList.remove('is-paused');
    }
  };

  video.addEventListener('play', syncOverlay);
  video.addEventListener('pause', syncOverlay);
  video.addEventListener('ended', () => {
    // ëë‚¬ì„ ë•ŒëŠ” ë‹¤ì‹œ "ì²˜ìŒë¶€í„° ì¬ìƒ" ëŠë‚Œ â†’ ì‚¼ê°í˜•ìœ¼ë¡œ ë³µê·€
    hasPlayed = false;
    syncOverlay();
  });

  // ì´ˆê¸° ìƒíƒœ ë°˜ì˜
  syncOverlay();

  return wrapper;
}


      function setupVideoControls() {
        const videos = document.querySelectorAll('video');

        videos.forEach((video) => {
          const isCarousel = video.classList.contains('my-carousel-img');

          // ë„¤ì´í‹°ë¸Œ ì»¨íŠ¸ë¡¤ ì œê±°
          if (video.hasAttribute('controls')) {
            video.removeAttribute('controls');
          }

          // ì¸ë¼ì¸ ì¬ìƒ ê°•ì œ
          video.setAttribute('playsinline', '');
          video.setAttribute('webkit-playsinline', '');

          // êµ¬ì¡° ì„¸íŒ… (ìºëŸ¬ì…€: ì˜¤ë²„ë ˆì´ë§Œ, ì¼ë°˜: ë˜í¼+ì˜¤ë²„ë ˆì´)
          enhanceVideo(video);

          if (video.dataset.hasListener) return;

          // ìºëŸ¬ì…€ ë¹„ë””ì˜¤ìš© ì˜¤ë²„ë ˆì´ ìƒíƒœ ì‹±í¬

if (isCarousel) {
  const item = video.closest('.my-carousel-item');
  const overlay = item ? item.querySelector('.carousel-video-overlay') : null;
  let hasPlayed = false;

  const syncCarouselOverlay = () => {
    if (!overlay) return;

    if (!hasPlayed && video.paused) {
      // ì•„ì§ í•œ ë²ˆë„ ì¬ìƒ ì•ˆ í•œ ì´ˆê¸° ìƒíƒœ â†’ ì‚¼ê°í˜•
      overlay.classList.remove('is-playing', 'is-paused');
    } else if (!video.paused) {
      // ì¬ìƒ ì¤‘
      hasPlayed = true;
      overlay.classList.add('is-playing');
      overlay.classList.remove('is-paused');
    } else {
      // í•œ ë²ˆ ì´ìƒ ì¬ìƒí–ˆê³ , ì§€ê¸ˆì€ ë©ˆì¶˜ ìƒíƒœ â†’ ì •ì§€ ì•„ì´ì½˜
      overlay.classList.remove('is-playing');
      overlay.classList.add('is-paused');
    }
  };

  video.addEventListener('play', syncCarouselOverlay);
  video.addEventListener('pause', syncCarouselOverlay);
  video.addEventListener('ended', () => {
    // ëë‚œ ë’¤ì—ëŠ” ë‹¤ì‹œ "ì¬ìƒ ì¤€ë¹„" ìƒíƒœë¡œ ëŒë ¤ë†“ê³  ì‹¶ìœ¼ë©´:
    hasPlayed = false;
    syncCarouselOverlay();
  });

  // ì´ˆê¸° ìƒíƒœ ë°˜ì˜
  syncCarouselOverlay();
}


          // ê³µí†µ í´ë¦­ ì¬ìƒ/ì¼ì‹œì •ì§€
          video.addEventListener('click', function (e) {
            e.preventDefault();
            e.stopPropagation();

            if (video.paused) {
              video.play();
            } else {
              video.pause();
            }
          });

          // ëª¨ë°”ì¼ ë”ë¸”íƒ­ í™•ëŒ€ ë°©ì§€
          video.addEventListener('dblclick', function (e) {
            e.preventDefault();
          });

          video.dataset.hasListener = 'true';
        });
      }

      function setupAntiCopy() {
        // ìš°í´ë¦­ ì „ì²´ ì°¨ë‹¨
        document.addEventListener('contextmenu', function (e) {
          e.preventDefault();
        });

        // ì´ë¯¸ì§€/ë¹„ë””ì˜¤ ë“œë˜ê·¸ ë°©ì§€
        function applyNoDrag() {
          document.querySelectorAll('img, video').forEach((el) => {
            el.setAttribute('draggable', 'false');
          });
        }
        applyNoDrag();

        // ì¼ë¶€ ë‹¨ì¶•í‚¤ ì°¨ë‹¨
        document.addEventListener('keydown', function (e) {
          const key = e.key.toLowerCase();

          if ((e.ctrlKey || e.metaKey) && ['s', 'p', 'u', 'c'].includes(key)) {
            e.preventDefault();
          }

          if (key === 'f12') {
            e.preventDefault();
          }
        });
      }

      function setupAll() {
        setupVideoControls();
        setupAntiCopy();
      }

      document.addEventListener('astro:page-load', setupAll);
      document.addEventListener('DOMContentLoaded', setupAll);
    </script>
  </body>
</html>
